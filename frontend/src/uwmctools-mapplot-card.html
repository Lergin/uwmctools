<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">

<link rel="import" href="shared-styles.html">

<link rel="import" href="firebase-indexeddb-link.html">
<link rel="import" href="uwmctools-player.html">
<link rel="import" href="uwmctools-zone-behavior.html">
<link rel="import" href="uwmctools-location.html">

<dom-module id="uwmctools-mapplot-card">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 20px;
      }

      paper-card {
        width: 100%;
      }

      paper-item {
        background-color: #fff;
      }

      .title {
        background-color: inherit;
      }
    </style>
    <firebase-indexeddb-link path="uwmctools/mapplots/data/[[plotId]]" data="{{plot}}"></firebase-indexeddb-link>

    <paper-card heading="[[plot.area]] [[plot.number]]">
      <template is="dom-if" if="[[owner(plot.owners)]]">
        <paper-item>
          <uwmctools-player uuid="[[owner(plot.owners)]]"></uwmctools-player>
        </paper-item>
      </template>
      <paper-item>
        [[zoneSize(plot.pos)]] Bl√∂cke ([[zoneWidth(plot.pos)]]*[[zoneHeight(plot.pos)]])
      </paper-item>
      <paper-item>
        <uwmctools-location x="[[zoneCenterX(plot.pos)]]" z="[[zoneCenterZ(plot.pos)]]"></uwmctools-location>
      </paper-item>
      <paper-item class="title">Ehemalige Besitzer:</paper-item>
      <template is="dom-repeat" items="[[toArray(plot.owners)]]" filter="excludeCurrendOwner">
        <paper-item><uwmctools-player uuid="[[item.uuid]]"></uwmctools-player>&nbsp;([[timestampToDate(item.from)]] - [[timestampToDate(item.till)]])</paper-item>
      </template>
    </paper-card>
  </template>

  <script>
    Polymer({
      is: 'uwmctools-mapplot-card',
      behaviors: [UwmctoolsZoneBehavior],
      properties: {
        plotId: {
          type: String,
          value: ""
        },
      },
      excludeCurrendOwner: function(owner){
        return owner.till
      },
      owner: function(owners) {
        if(!owners) return false;

        for(let i of Object.keys(owners)) {
          if(!owners[i].till)
            return owners[i].uuid
        }

        return false;
      }
    });
  </script>
</dom-module>
