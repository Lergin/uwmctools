<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">

<link rel="import" href="uwmctools-notification-toggle-button.html">
<link rel="import" href="uwmctools-column-timeline-chart.html">
<link rel="import" href="firebase-indexeddb-link.html">

<dom-module id="uwmctools-view-player-overview">
  <template>
    <style include="shared-styles app-grid-style">
      :host {
        display: block;

        padding: 10px;

        --app-grid-columns: 2;
      }

      .app-grid div {
        padding: 20px;
      }

      paper-card {
        width: 100%;
      }

      paper-item {
        background-color: #fff;
      }
      
      paper-card {
        --paper-card-header-image: {
              width: 30%;
              margin-left: 35%;
              margin-top: 20px;
              margin-bottom: 20px;
        }
      }

      @media (max-width: 1300px) {
        :host {
          --app-grid-columns: 2;
        }
      }

      @media (max-width: 900px) {
        :host {
          --app-grid-columns: 1;
        }
      }
    </style>

    <div class="app-grid">
      <div>
        <paper-card 
          heading="Übersicht"
          image="https://crafatar.com/renders/head/[[uuid]]?overlay&scale=10"
          fade-image
          placeholfer-image="https://crafatar.com/renders/head/MHF_STEAVE?overlay&scale=10">
          <paper-item>[[uuid]]</paper-item>
          <paper-item>[[_computeUwmcRank(player.rank)]]</paper-item>
          <template is="dom-if" if="[[player.boardId]]">
            <a href="https://unlimitedworld.de/member.php?[[player.boardId]]">
              <paper-item>Zur Forenseite</paper-item>
            </a>
          </template>
        </paper-card>
      </div>
      <div>
        <paper-card heading="Rangänderungen">
          <template is="dom-repeat" items="[[_convertToArray(player.rankchanges)]]" sort="_sortByKey">
              <paper-item>[[_computeDate(item.key)]] - [[_computeUwmcRank(item.val)]]</paper-item>
          </template>
        </paper-card>
      </div>
      <div>
        <paper-card heading="Benachrichtigungen">
          <paper-item>
            <uwmctools-notification-toggle-button topic="UWMCTOOLS_PLAYER_RANKCHANGE_[[uuid]]"></uwmctools-notification-toggle-button>
            Rangänderungen
          </paper-item>
          <paper-item>
            <uwmctools-notification-toggle-button topic="UWMCTOOLS_PLAYER_ONLINE_[[uuid]]"></uwmctools-notification-toggle-button>
            Spieler kommt Online
          </paper-item>
          <paper-item>
            <uwmctools-notification-toggle-button topic="UWMCTOOLS_PLAYER_OFFLINE_[[uuid]]"></uwmctools-notification-toggle-button>
            Spieler geht Offline
          </paper-item>
        </paper-card>
      </div>
      <uwmctools-column-timeline-chart 
        cols='["Vote 1", "Vote 2"]'
        timeline='[[player.votes]]'
        title="Votes pro Monat">
      </uwmctools-column-timeline-chart>
    </div>
  </template>

  <script>
    Polymer({
      is: 'uwmctools-view-player-overview',
      properties: {
        player: {
            type: Object
        }
      },
      _computeUwmcRank(rank) {
        switch (rank) {
          case 10:
            return "Owner";
          case 20:
            return "Dev";
          case 30:
            return "Admin";
          case 40:
            return "Mod";
          case 45:
            return "Builder"
          case 50:
            return "Buddy";
          case 60:
            return "Guard";
          case 70:
            return "Trusty";
          case 80:
            return "Spieler";
          case 90:
            return "Gast";
          default:
            return "unknown";
        }
      },
      _computeDate: function(timestamp){
        return new Date(parseInt(timestamp)).toLocaleDateString();
      },
      _convertToArray: function(objs) {
        var array = [];
        for(var obj in objs){
          let res = {};
          res.val = objs[obj];
          res.key = obj
          array.push(res);
        }

        return array;
      },
      _sortByKey(a, b) {
        return a.key > b.key ? -1 : a.key < b.key ? 1 : 0;
      },
    });
  </script>
</dom-module>
